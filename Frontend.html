<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Interface Utilisateur</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        /* Container for 3D viewer */
        .three-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* Overlay info grid */
        .info-container {
            position: relative;
            z-index: 2;
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-template-rows: repeat(7, 1fr);
            grid-column-gap: 0px;
            grid-row-gap: 0px;
            color: #ffffff;
            place-items: center;
            padding: 16px;
            background: rgba(255, 255, 255, 0); /* Semi-transparent background for readability */
            border-radius: 10px;
            margin: 32px auto;
            max-width: 80%; /* Centered grid with a width limit */
        }

        .long-bulle {
            border: #ffffff solid 1px;
            border-radius: 35px;
        }

        .bulle {
            border: #ffffff solid 1px;
            width: 50%;
            height: 0;
            padding-top: 25%;
            border-radius: 50%;
            padding-bottom: 25%;                
        }

        .div1 {
            grid-area: 1 / 3 / 2 / 6;
            display: flex;
            justify-content: center;
            align-items: center;
            padding-left: 25px;
            padding-right: 25px;
        }
        .div2 {
            grid-area: 3 / 1 / 4 / 2;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-left: -15vw;
        }
        .div3 {
            grid-area: 4 / 1 / 5 / 2;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-left: -15vw;
        }
        .div4 {
            grid-area: 4 / 2 / 5 / 3;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-left: -15vw;
        }
        .div5 {
            grid-area: 5 / 2 / 6 / 3;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-left: -15vw;
        }
        .div6 {
            grid-area: 3 / 3 / 4 / 4;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-left: -15vw;
        }
        .div7 {
            grid-area: 4 / 3 / 5 / 4;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-left: -15vw;
        }
        .div8 {
            grid-area: 3 / 5 / 4 / 6;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: -15vw;
        }
        .div9 {
            grid-area: 4 / 5 / 5 / 6;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: -15vw;
        }
        .div10 {
            grid-area: 4 / 6 / 5 / 7;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: -15vw;
        }
        .div11 {
            grid-area: 5 / 6 / 6 / 7;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: -15vw;
        }
        .div12 {
            grid-area: 3 / 7 / 4 / 8;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: -15vw;
        }
        .div13 {
            grid-area: 4 / 7 / 5 / 8;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: -15vw;
        }
        .div14 {
            grid-area: 7 / 1 / 8 / 4;
            display: flex;
            justify-content: center;
            align-items: center;
            padding-left: 20px;
            padding-right: 20px;
            margin-left: -15vw;
        }
        .div15 {
            grid-area: 7 / 6 / 8 / 7;
            display: flex;
            justify-content: center;
            align-items: center;
            padding-left: 20px;
            padding-right: 20px;
            margin-right: -15vw;
        }
    </style>
    <script type="importmap">
        {
            "imports": {
                "three": "/three.js-dev/build/three.module.js"
            }
        }
    </script>
</head>
<body>
    <!-- 3D Viewer Background -->
    <div class="three-container"></div>

    <!-- Info Grid Overlay -->
    <div class="info-container">
        <div class="div1 long-bulle">
            <h1>loading...</h1> 
        </div>
        <div class="div2 bulle">loading...</div>
        <div class="div3"><h3>Vigueur</h3></div>
        <div class="div4 bulle">loading...</div>
        <div class="div5"><h3>Présence</h3></div>
        <div class="div6 bulle">loading...</div>
        <div class="div7"><h3>Agilité</h3></div>
        <div class="div8 bulle">loading...</div>
        <div class="div9"><h3>Intelligence</h3></div>
        <div class="div10 bulle">loading...</div>
        <div class="div11"><h3>Volonté</h3></div>
        <div class="div12 bulle">loading...</div>
        <div class="div13"><h3>Ruse</h3></div>
        <div class="div14 long-bulle"><h3>loading...</h3></div>
        <div class="div15 long-bulle"><h3>loading...</h3></div>
    </div>

    <script type="module">
        // Three.js and STL Loader Script
        import * as THREE from 'three';
        import { OrbitControls } from '/three.js-dev/examples/jsm/controls/OrbitControls.js';
        import { STLLoader } from '/three.js-dev/examples/jsm/loaders/STLLoader.js';

        let _3D_model = ""

        // Fetch Data for Info Grid
        document.addEventListener('DOMContentLoaded', () => {
            fetch('/api/data')
                .then(response => response.json())
                .then(data => {
                    let _3D_model = data.file_path; // Assume this contains the filename

                    console.log('Loaded 3D Model:', _3D_model);
                    // Update the UI or use _3D_model as needed
                    document.querySelector('.div1 h1').textContent = data.nom_perso;
                    document.querySelector('.div2').textContent = data.vigueur;
                    document.querySelector('.div4').textContent = data.presence;
                    document.querySelector('.div6').textContent = data.agilite;
                    document.querySelector('.div8').textContent = data.intelligence;
                    document.querySelector('.div10').textContent = data.volonte;
                    document.querySelector('.div12').textContent = data.ruse;
                    document.querySelector('.div14 h3').textContent = 'Situation : ' + data.situation;
                    document.querySelector('.div15 h3').textContent = 'Crédits : ' + data.credit + ' $';
                    // Introduce a delay before loading the 3D model
                    
                    const loader = new STLLoader();
                    let final_path = '/3D/' + _3D_model;

                    loader.load(final_path,
                        (geometry) => {
                            geometry.center();
                            const material = new THREE.MeshPhysicalMaterial({ color: 0xffffff });
                            const mesh = new THREE.Mesh(geometry, material);
                            mesh.scale.set(0.02, 0.02, 0.02);
                            mesh.rotation.set(-1.5, 0, 0);
                            function animate() {
                                requestAnimationFrame(animate);
                                controls.update();
                                if (mesh) mesh.rotation.z += 0.005;
                                renderer.render(scene, camera);
                            }
                            scene.add(mesh);
                            animate();
                        },
                        undefined,
                        (error) => console.error('Error loading 3D model:', error)
                    );
                })
                .catch(error => console.error('Error fetching data:', error));
            // Set up the Three.js scene
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000000);
            const hemisphereLight = new THREE.HemisphereLight(0xffffff, 0x444444, 0.8);
            scene.add(hemisphereLight);
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 4;
            const renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.querySelector('.three-container').appendChild(renderer.domElement);
            const controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            function onWindowResize() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
            window.addEventListener('resize', onWindowResize);
        });
    </script>
</body>
</html>
